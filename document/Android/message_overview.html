<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>消息管理 | 环信 IM 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/vuepress/logo.png">
    <meta name="description" content="环信即时通讯云最新集成文档，一天内即可帮APP快速集成聊天功能。 环信客户互动云集成文档，快速多渠道集成，为企业提供智能客服系统。">
    
    <link rel="preload" href="/vuepress/assets/css/0.styles.7ff8f1d4.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.3775eb30.js" as="script"><link rel="preload" href="/vuepress/assets/js/3.db456b6c.js" as="script"><link rel="preload" href="/vuepress/assets/js/1.7ac2d96d.js" as="script"><link rel="preload" href="/vuepress/assets/js/19.c2a72fc0.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.e8437e28.js"><link rel="prefetch" href="/vuepress/assets/js/11.9fe3bf56.js"><link rel="prefetch" href="/vuepress/assets/js/12.5bdc7cb4.js"><link rel="prefetch" href="/vuepress/assets/js/13.fd9a688c.js"><link rel="prefetch" href="/vuepress/assets/js/14.c5d1ee43.js"><link rel="prefetch" href="/vuepress/assets/js/15.6249d44e.js"><link rel="prefetch" href="/vuepress/assets/js/16.e2333c54.js"><link rel="prefetch" href="/vuepress/assets/js/17.a016e123.js"><link rel="prefetch" href="/vuepress/assets/js/18.a4e71e3e.js"><link rel="prefetch" href="/vuepress/assets/js/20.5ef4c978.js"><link rel="prefetch" href="/vuepress/assets/js/21.f02692d3.js"><link rel="prefetch" href="/vuepress/assets/js/22.6674015c.js"><link rel="prefetch" href="/vuepress/assets/js/23.7270cb71.js"><link rel="prefetch" href="/vuepress/assets/js/24.24b1ec9d.js"><link rel="prefetch" href="/vuepress/assets/js/25.d5729017.js"><link rel="prefetch" href="/vuepress/assets/js/26.48b974ea.js"><link rel="prefetch" href="/vuepress/assets/js/27.5accaed6.js"><link rel="prefetch" href="/vuepress/assets/js/28.0263440e.js"><link rel="prefetch" href="/vuepress/assets/js/29.598a97cf.js"><link rel="prefetch" href="/vuepress/assets/js/30.c348f978.js"><link rel="prefetch" href="/vuepress/assets/js/31.e8ccf099.js"><link rel="prefetch" href="/vuepress/assets/js/32.0e645f12.js"><link rel="prefetch" href="/vuepress/assets/js/33.24a50465.js"><link rel="prefetch" href="/vuepress/assets/js/34.ff18a349.js"><link rel="prefetch" href="/vuepress/assets/js/35.4e68b9ba.js"><link rel="prefetch" href="/vuepress/assets/js/36.efabe680.js"><link rel="prefetch" href="/vuepress/assets/js/37.662d4795.js"><link rel="prefetch" href="/vuepress/assets/js/38.126de51e.js"><link rel="prefetch" href="/vuepress/assets/js/39.95565ede.js"><link rel="prefetch" href="/vuepress/assets/js/4.e2bccb64.js"><link rel="prefetch" href="/vuepress/assets/js/40.6de23b15.js"><link rel="prefetch" href="/vuepress/assets/js/41.6d31188a.js"><link rel="prefetch" href="/vuepress/assets/js/42.f3454cae.js"><link rel="prefetch" href="/vuepress/assets/js/43.785e27a0.js"><link rel="prefetch" href="/vuepress/assets/js/44.2732245f.js"><link rel="prefetch" href="/vuepress/assets/js/45.aa9d062b.js"><link rel="prefetch" href="/vuepress/assets/js/46.f1767cea.js"><link rel="prefetch" href="/vuepress/assets/js/47.6ea90c89.js"><link rel="prefetch" href="/vuepress/assets/js/48.56a5e7e6.js"><link rel="prefetch" href="/vuepress/assets/js/49.8203ac0c.js"><link rel="prefetch" href="/vuepress/assets/js/5.05775f0d.js"><link rel="prefetch" href="/vuepress/assets/js/50.30fd124a.js"><link rel="prefetch" href="/vuepress/assets/js/51.6e8fe59e.js"><link rel="prefetch" href="/vuepress/assets/js/52.3d80ae80.js"><link rel="prefetch" href="/vuepress/assets/js/53.71b8512d.js"><link rel="prefetch" href="/vuepress/assets/js/6.7df3bdd1.js"><link rel="prefetch" href="/vuepress/assets/js/7.0be7f205.js"><link rel="prefetch" href="/vuepress/assets/js/8.5daa8986.js"><link rel="prefetch" href="/vuepress/assets/js/9.08e122ea.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.7ff8f1d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div><div class="header-container"><div class="logo"><a href="/vuepress/" class="router-link-active"><span><img src="/vuepress/logo.png"></span> <h1>环信 IM 文档</h1></a></div> <div class="nav pc-nav"><div class="main-nav"><a href="/vuepress/product/introduction.html">产品简介</a><a href="/vuepress/document/Android/quickstart" class="active">集成文档</a><a href="/vuepress/api/Android">API 参考</a></div> <div class="nav-extra"><div class="search-container"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="secondary-nav"><a href="https://console.easemob.com/ticket" target="_blank">提交工单</a></div> <div class="switch-lang"><a href="javascript:;">选择语言<span class="triangle"></span></a> <div id="sub-menu" class="sub-menu menu-hidden"><ul><li class="active"><a href="/vuepress/document/Android/message_overview.html" aria-current="page" class="router-link-exact-active router-link-active">简体中文</a></li><li><a href="/vuepress/en/document/Android/message_overview.html">English</a></li></ul></div></div> <div class="login-register"><a href="https://console.easemob.com/user/login" target="_blank">登录</a><a href="https://console.easemob.com/user/register" target="_blank">注册</a></div></div></div> <div class="mobile-nav"><img src="/vuepress/icon-menu.png"></div></div> <!----> <!----></div> <div class="content-container"><div class="sider-container"><div class="platform"><div class="platform-input"><div class="platform-text"><img src="/vuepress/icon-Android-hover.svg" alt> <span>Android</span></div> <div class="select-icon"><i class="icon-arrow"></i></div></div> <div id="platform-list" class="platform-list menu-hidden"><!----><div class="group"><div class="group-title">平台</div> <div class="options"><div data-key="Android" class="option-item"><img src="/vuepress/icon-Android.svg" alt class="default"> <img src="/vuepress/icon-Android-hover.svg" alt class="active"> <span>Android</span></div><div data-key="iOS" class="option-item"><img src="/vuepress/icon-iOS.svg" alt class="default"> <img src="/vuepress/icon-iOS-hover.svg" alt class="active"> <span>iOS</span></div><div data-key="Web" class="option-item"><img src="/vuepress/icon-web.svg" alt class="default"> <img src="/vuepress/icon-web-hover.png" alt class="active"> <span>Web</span></div><div data-key="Windows" class="option-item"><img src="/vuepress/icon-windows.svg" alt class="default"> <img src="/vuepress/icon-windows-hover.svg" alt class="active"> <span>Windows</span></div></div></div><div class="group"><div class="group-title">框架</div> <div class="options"><div data-key="Mini-program" class="option-item"><img src="/vuepress/icon-mini-program.svg" alt class="default"> <img src="/vuepress/icon-mini-program-hover.svg" alt class="active"> <span>小程序</span></div><div data-key="Flutter" class="option-item"><img src="/vuepress/icon-flutter.svg" alt class="default"> <img src="/vuepress/icon-flutter-hover.png" alt class="active"> <span>Flutter</span></div><div data-key="React-Native" class="option-item"><img src="/vuepress/icon-ReactNative.svg" alt class="default"> <img src="/vuepress/icon-ReactNative-hover.svg" alt class="active"> <span>React Native</span></div></div></div><div class="group"><div class="group-title"></div> <div class="options"><div data-key="Server-side" class="option-item"><img src="/vuepress/icon-server-dark.png" alt class="default"> <img src="/vuepress/icon-server-light.png" alt class="active"> <span>服务端</span></div></div></div></div></div> <div class="sider-menu"><div class="item"><h2>快速开始</h2> <ul><li><a href="/vuepress/document/Android/demo_android.html">Demo（EaseIM App）</a></li><li><a href="/vuepress/document/Android/quick_start_android.html">快速开始（不使用 EaseIMKIT）</a></li></ul></div><div class="item"><h2>基础功能</h2> <ul><li><div><a href="javascript:;">消息管理<i class="icon-arrow open"></i></a> <ul class="sider-menu-sub collapsable"><li class="active"><a href="/vuepress/document/Android/message_overview_android.html">消息概述</a></li><li><a href="/vuepress/document/Android/message_send_receive_android.html">发送和接收消息</a></li><li><a href="/vuepress/document/Android/message_manage_android.html">管理本地消息数据</a></li><li><a href="/vuepress/document/Android/message_retrieve_android.html">从服务器获取消息（消息漫游）</a></li><li><a href="/vuepress/document/Android/message_receipt_android.html">管理消息回执</a></li><li><a href="/vuepress/document/Android/message_translation_android.html">翻译</a></li></ul></div></li><li><a href="/vuepress/document/Android/userprofile_android.html">管理用户属性</a></li><li><a href="/vuepress/document/Android/user_relationship_android.html">管理用户关系</a></li><li><div><a href="javascript:;">群组管理<i class="icon-arrow"></i></a> <ul class="sider-menu-sub collapsable menu-hidden"><li><a href="/vuepress/document/Android/group_overview_android.html">群组概述</a></li><li><a href="/vuepress/document/Android/group_manage_android.html">管理群组</a></li><li><a href="/vuepress/document/Android/group_members_android.html">管理群组成员</a></li><li><a href="/vuepress/document/Android/group_attributes_android.html">管理群组属性</a></li></ul></div></li><li><div><a href="javascript:;">聊天室管理<i class="icon-arrow"></i></a> <ul class="sider-menu-sub collapsable menu-hidden"><li><a href="/vuepress/document/Android/room_overview_android.html">聊天室概述</a></li><li><a href="/vuepress/document/Android/room_manage_android.html">创建和管理聊天室</a></li><li><a href="/vuepress/document/Android/room_members_android.html">管理聊天室成员</a></li><li><a href="/vuepress/document/Android/room_attributes_android.html">管理聊天室属性</a></li></ul></div></li></ul></div><div class="item"><h2>进阶功能</h2> <ul><li><a href="/vuepress/document/Android/multi_device_android.html">登录多个设备</a></li><li><a href="/vuepress/document/Android/presence_android.html">管理在线状态订阅</a></li><li><a href="/vuepress/document/Android/reaction_android.html">消息表情回复</a></li><li><div><a href="javascript:;">子区管理<i class="icon-arrow"></i></a> <ul class="sider-menu-sub collapsable menu-hidden"><li><a href="/vuepress/document/Android/thread_android.html">管理子区</a></li><li><a href="/vuepress/document/Android/thread_message_android.html">管理子区消息</a></li></ul></div></li><li><a href="/vuepress/document/Android/moderation_report_android.html">消息审核</a></li></ul></div><div class="item"><h2>其他</h2> <ul><li><a href="/vuepress/document/Android/error_android.html">错误码</a></li></ul></div></div></div> <div data-key="v-fc7f00ae" class="description-container"><div><div class="content__default"><h1 id="消息管理"><a href="#消息管理" class="header-anchor">#</a> 消息管理</h1> <p></p><div class="table-of-contents"><ul><li><a href="#功能描述">功能描述</a><ul><li><a href="#消息类型">消息类型</a></li><li><a href="#消息功能">消息功能</a></li></ul></li></ul></div><p></p> <h2 id="功能描述"><a href="#功能描述" class="header-anchor">#</a> 功能描述</h2> <p>环信即时通讯 IM 支持多种消息类型，开发者可以方便地对本地会话、消息进行管理，可以从服务端获取历史会话和消息，提供送达回执和已读回执能力。</p> <p>消息：环信即时通讯 IM 中消息（Message）表示发送方给接收方发送的内容，消息包括多种类型，如：文本、图片、语音等。</p> <p>会话：环信即时通讯 IM 中会话（Conversation）分为 3 种，单聊、群聊、聊天室会话。单聊是指 2 个用户建立的会话，双方可以在会话中收发消息。群聊会话是由群成员发送消息所组成的，群成员可以在群会话中首发消息。聊天室会话与群聊会话类似。</p> <h3 id="消息类型"><a href="#消息类型" class="header-anchor">#</a> 消息类型</h3> <table><thead><tr><th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">文本消息</td> <td style="text-align:left;">文本消息的内容是文本，可以包含超链接、emoji 表情符号等。表情消息是基于文本消息实现的。<br> 文本消息大小限制为 5 KB。</td></tr> <tr><td style="text-align:left;">图片消息</td> <td style="text-align:left;">图片消息是附件消息，需要先将图片上传至消息服务器。接收方收到图片时自动下载图片缩略图。<br> 图片消息大小限制为 10 MB。</td></tr> <tr><td style="text-align:left;">语音消息</td> <td style="text-align:left;">语音消息是附件消息，需要先将语音上传至消息服务器。接收方收到语音时自动下载语音。<br> 语音消息大小限制为 10 MB。</td></tr> <tr><td style="text-align:left;">视频消息</td> <td style="text-align:left;">视频消息是附件消息，需要先将视频上传至消息服务器。接收方收到视频时自动下载视频缩略图，点击下载视频消息。<br> 视频消息大小限制为 10 MB。</td></tr> <tr><td style="text-align:left;">文件消息</td> <td style="text-align:left;">文件消息是附件消息，需要先将文件上传至消息服务器。接收方收到文件时自动下载文件。<br> 文件消息大小限制为 10 MB。</td></tr> <tr><td style="text-align:left;">位置消息</td> <td style="text-align:left;">位置消息需要第三方的地图服务提供经纬度信息。接收方接收到位置消息，通过经纬度信息可以在第三方的地图服务中显示位置。</td></tr> <tr><td style="text-align:left;">透传消息</td> <td style="text-align:left;">透传消息可视为命令消息，通过发送这条命令给对方，通知对方要执行的操作，对方收到消息后系统可以自定义处理。透传消息不会在 UI 上展示。<br>  消息大小显示为 5 KB。<br> 透传消息的使用场景：头像、昵称的更新、状态同步等。<br> 透传消息不会存入本地数据库。</td></tr> <tr><td style="text-align:left;">消息自定义扩展</td> <td style="text-align:left;">当基础的消息类型不满足需求时，可以使用消息自定义扩展增强基础消息类型。<br> 使用扩展后，消息大小不能超过原类型消息的大小。<br> 消息自定义扩展的使用场景：消息中需要携带被回复的消息内容和图文消息等。</td></tr> <tr><td style="text-align:left;">自定义消息</td> <td style="text-align:left;">开发者自定义的消息类型。自定义消息支持设置类型名称，开发者可以添加多种自定义消息。<br> 自定义消息大小限制为 5 KB。<br> 自定义消息的使用场景：红包消息、模板消息等。</td></tr></tbody></table> <h3 id="消息功能"><a href="#消息功能" class="header-anchor">#</a> 消息功能</h3> <h4 id="管理本地消息数据"><a href="#管理本地消息数据" class="header-anchor">#</a> 管理本地消息数据</h4> <p>使用环信即时通讯 IM 发送和接收到的消息会存储在本地数据库，用户在本地进行消息的操作。消息以会话为单位进行管理，可基于会话为加载和展示消息。</p> <table><thead><tr><th style="text-align:left;">功能</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">获取本地所有会话</td> <td style="text-align:left;">获取本地所有的会话。本地存储的消息有已读和未读状态，获取时包含未读消息数。</td></tr> <tr><td style="text-align:left;">从数据库中读取指定会话的消息</td> <td style="text-align:left;">从本地数据库获取指定会话的消息，进入会话时，获取会话内容。</td></tr> <tr><td style="text-align:left;">获取指定会话的未读消息数量</td> <td style="text-align:left;">从本地数据库获取指定会话的未读消息数，显示指定会话的未读消息数。</td></tr> <tr><td style="text-align:left;">获取所有会话的未读消息数量</td> <td style="text-align:left;">从本地数据库获取所有会话的未读消息数，显示整个应用的未读消息数。</td></tr> <tr><td style="text-align:left;">未读消息数清零</td> <td style="text-align:left;">查看未读消息后，未读消息数清零。可对指定会话和所有会话进行未读消息数清零。</td></tr> <tr><td style="text-align:left;">删除会话及聊天记录</td> <td style="text-align:left;">删除本地会话，会话里的聊天记录是否删除是可选项。</td></tr> <tr><td style="text-align:left;">根据关键字搜索会话消息</td> <td style="text-align:left;">根据关键字对会话里的消息内容进行搜索。</td></tr> <tr><td style="text-align:left;">导入消息到数据库</td> <td style="text-align:left;">将外部消息导入本地数据库。需构造消息对象。</td></tr> <tr><td style="text-align:left;">插入消息</td> <td style="text-align:left;">模拟收到某些消息通知，可以构造一条消息并写入会话。</td></tr></tbody></table> <h4 id="从服务器获取消息"><a href="#从服务器获取消息" class="header-anchor">#</a> 从服务器获取消息</h4> <p>环信即时通讯 IM 在消息服务器保存历史消息，方便用户在新设备上获取历史消息。
历史消息存储时间与套餐版本相关：历史消息存储时间与套餐版本相关：专业版 7 天，旗舰版版 90 天， 尊享版 180 天。</p> <table><thead><tr><th style="text-align:left;">功能</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">从服务器获取会话</td> <td style="text-align:left;">从服务端获取会话。</td></tr> <tr><td style="text-align:left;">分页获取指定会话的历史消息</td> <td style="text-align:left;">从服务端分页获取会话的历史消息。</td></tr></tbody></table> <h4 id="获取消息的已读回执和送达回执"><a href="#获取消息的已读回执和送达回执" class="header-anchor">#</a> 获取消息的已读回执和送达回执</h4> <p>环信即时通讯 IM 消息投递成功会返回送达回执，而且提供消息已读功能，接收方查看消息后会返回已读回执。</p> <table><thead><tr><th style="text-align:left;">功能</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">单聊消息送达回执</td> <td style="text-align:left;">消息下发成功后，返回消息送达回执。</td></tr> <tr><td style="text-align:left;">单聊消息已读回执</td> <td style="text-align:left;">接收方查看消息后，返回消息已读回执。</td></tr> <tr><td style="text-align:left;">单聊会话已读回执</td> <td style="text-align:left;">接收方查看单聊会话后，返回会话已读回执。</td></tr> <tr><td style="text-align:left;">群组消息已读回执</td> <td style="text-align:left;">提供群组消息已读回执能力。</td></tr></tbody></table></div> <div class="back-to-top hidden"></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/maniacflow/vuepress/edit/master/docs/document/Android/message_overview_android.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated">更新时间：2022/7/26 下午6:26:25</div></div></div></div> <link id="code-theme" rel="stylesheet"></div><div class="global-ui"></div></div>
    <script src="/vuepress/assets/js/app.3775eb30.js" defer></script><script src="/vuepress/assets/js/3.db456b6c.js" defer></script><script src="/vuepress/assets/js/1.7ac2d96d.js" defer></script><script src="/vuepress/assets/js/19.c2a72fc0.js" defer></script>
  </body>
</html>
